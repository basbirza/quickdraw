<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title">Product | Quickdraw Pressing Co.</title>
  <meta name="description" id="page-description" content="Premium selvedge denim and Americana wear">

  <!-- Open Graph -->
  <meta property="og:title" id="og-title" content="Quickdraw Pressing Co.">
  <meta property="og:description" id="og-description" content="Premium selvedge denim">
  <meta property="og:image" id="og-image" content="">
  <meta property="og:type" content="product">

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rye&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Georgia', 'Times New Roman', serif;
    }
    .logo-title {
      font-family: 'Rye', cursive;
      font-size: clamp(32px, 5vw, 52px);
      letter-spacing: 0.12em;
      color: #111;
      margin: 0;
      line-height: 1.1;
    }
    .logo-subtitle {
      font-family: Georgia, serif;
      letter-spacing: 0.3em;
      font-size: 10px;
    }
    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .accordion-content.active {
      max-height: 500px;
    }
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #111;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="min-h-screen bg-white text-gray-900">

  <!-- Announcement Bar -->
  <div class="bg-black text-white text-center py-2 text-xs tracking-widest">
    FREE SHIPPING ON ORDERS ABOVE €150 — SUBSCRIBE & GET 10% OFF
  </div>

  <!-- Header -->
  <header class="border-b border-gray-200 px-4 md:px-8 py-5">
    <!-- Logo -->
    <div class="text-center">
      <a href="/index.html" class="inline-block">
        <h1 class="logo-title">QUICKDRAW</h1>
        <div class="flex items-center justify-center gap-3 mt-1">
          <div class="h-px bg-gray-300 w-12 md:w-20"></div>
          <span class="text-xs tracking-widest text-gray-500 logo-subtitle">PRESSING CO.</span>
          <div class="h-px bg-gray-300 w-12 md:w-20"></div>
        </div>
      </a>
    </div>

    <!-- Navigation -->
    <nav class="flex justify-center gap-5 md:gap-8 mt-4 overflow-x-auto" id="main-nav">
      <a href="/new-in.html" class="nav-item text-xs tracking-widest whitespace-nowrap pb-1 transition-all duration-200 text-gray-600 hover:text-black">NEW IN</a>
      <a href="/denim.html" class="nav-item text-xs tracking-widest whitespace-nowrap pb-1 transition-all duration-200 text-gray-600 hover:text-black">DENIM</a>
      <a href="/americana.html" class="nav-item text-xs tracking-widest whitespace-nowrap pb-1 transition-all duration-200 text-gray-600 hover:text-black">AMERICANA</a>
      <a href="/accessories.html" class="nav-item text-xs tracking-widest whitespace-nowrap pb-1 transition-all duration-200 text-gray-600 hover:text-black">ACCESSORIES</a>
      <a href="denim-guide.html" class="nav-item text-xs tracking-widest whitespace-nowrap pb-1 transition-all duration-200 text-gray-600 hover:text-black">DENIM GUIDE</a>
      <a href="journal.html" class="nav-item text-xs tracking-widest whitespace-nowrap pb-1 transition-all duration-200 text-gray-600 hover:text-black">JOURNAL</a>
      <a href="/sale.html" class="nav-item text-xs tracking-widest whitespace-nowrap pb-1 transition-all duration-200" style="color: #c45a3a;">SALE</a>
    </nav>
  </header>

  <!-- Breadcrumb -->
  <div class="max-w-7xl mx-auto px-4 md:px-8 py-4">
    <div class="flex gap-2 text-xs text-gray-500" id="breadcrumb">
      <a href="/index.html" class="hover:text-black transition-colors">Home</a>
      <span>/</span>
      <span id="breadcrumb-category">Loading...</span>
      <span>/</span>
      <span class="text-gray-900" id="breadcrumb-product">...</span>
    </div>
  </div>

  <!-- Loading State -->
  <div id="loading-state" class="max-w-7xl mx-auto px-4 md:px-8 pb-16 text-center py-20">
    <div class="loading-spinner mx-auto mb-4"></div>
    <p class="text-gray-500">Loading product...</p>
  </div>

  <!-- Error State -->
  <div id="error-state" class="max-w-7xl mx-auto px-4 md:px-8 pb-16 text-center py-20 hidden">
    <h2 class="text-2xl mb-4">Product Not Found</h2>
    <p class="text-gray-600 mb-6">Sorry, we couldn't find the product you're looking for.</p>
    <a href="/index.html" class="inline-block bg-black text-white px-8 py-3 text-xs tracking-widest hover:bg-gray-800 transition-colors">
      BACK TO HOME
    </a>
  </div>

  <!-- Product Section -->
  <section id="product-content" class="max-w-7xl mx-auto px-4 md:px-8 pb-16 hidden">
    <div class="grid md:grid-cols-2 gap-8 md:gap-12">

      <!-- Image Gallery -->
      <div class="space-y-3">
        <!-- Main Image -->
        <div class="relative overflow-hidden bg-gray-100" style="aspect-ratio: 3/4;">
          <img src="" alt="" class="absolute inset-0 w-full h-full object-contain" id="main-product-image">
          <span id="product-tag" class="absolute top-3 left-3 bg-black text-white text-xs px-2 py-0.5 tracking-wider hidden" style="font-size: 10px;"></span>
        </div>

        <!-- Thumbnail Grid -->
        <div id="thumbnail-grid" class="grid grid-cols-5 gap-2">
          <!-- Thumbnails will be populated dynamically -->
        </div>
      </div>

      <!-- Product Info -->
      <div class="space-y-6">
        <!-- Title & Price -->
        <div class="border-b border-gray-200 pb-6">
          <p id="product-category" class="text-xs tracking-widest text-gray-400 mb-2">CATEGORY</p>
          <h1 id="product-name" class="text-2xl md:text-3xl mb-3" style="letter-spacing: 0.05em;">Product Name</h1>
          <p id="product-price" class="text-lg text-gray-900 mb-4">€0</p>
          <p id="product-description" class="text-sm text-gray-600 leading-relaxed">
            Product description will appear here.
          </p>
        </div>

        <!-- Fabric Specs -->
        <div id="fabric-specs" class="border border-gray-200 p-4 bg-gray-50">
          <p class="text-xs tracking-widest text-gray-900 mb-3">FABRIC SPECIFICATIONS</p>
          <div class="grid grid-cols-2 gap-3 text-xs" id="specs-grid">
            <!-- Specs will be populated dynamically -->
          </div>
        </div>

        <!-- Size Selector -->
        <div>
          <div class="flex justify-between items-center mb-3">
            <p class="text-xs tracking-widest text-gray-900">SELECT SIZE</p>
            <button class="text-xs text-gray-500 hover:text-black border-b border-gray-400 hover:border-black pb-0.5 transition-all">
              SIZE GUIDE
            </button>
          </div>
          <div id="size-selector" class="grid grid-cols-5 gap-2">
            <!-- Size buttons will be populated dynamically -->
          </div>
        </div>

        <!-- Add to Cart -->
        <div class="space-y-3">
          <button id="add-to-cart-btn" class="w-full bg-black text-white text-xs tracking-widest py-4 hover:bg-gray-800 transition-colors">
            ADD TO CART
          </button>
          <button id="add-to-wishlist-btn" class="w-full border border-gray-300 text-gray-900 text-xs tracking-widest py-4 hover:border-black transition-colors">
            ♡ ADD TO WISHLIST
          </button>
        </div>

        <!-- Accordions -->
        <div class="space-y-2 border-t border-gray-200 pt-6">
          <!-- Product Details -->
          <div class="accordion-item border border-gray-200">
            <button class="accordion-header w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 transition-colors">
              <span class="text-xs tracking-widest text-gray-900">PRODUCT DETAILS</span>
              <span class="accordion-icon text-gray-400">+</span>
            </button>
            <div class="accordion-content">
              <div id="product-details-content" class="px-4 pb-4 text-xs text-gray-600 leading-relaxed space-y-2">
                <p>Product details will load here...</p>
              </div>
            </div>
          </div>

          <!-- Sizing & Fit -->
          <div class="accordion-item border border-gray-200">
            <button class="accordion-header w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 transition-colors">
              <span class="text-xs tracking-widest text-gray-900">SIZING & FIT</span>
              <span class="accordion-icon text-gray-400">+</span>
            </button>
            <div class="accordion-content">
              <div id="product-sizing-content" class="px-4 pb-4 text-xs text-gray-600 leading-relaxed space-y-2">
                <p>Sizing information will load here...</p>
              </div>
            </div>
          </div>

          <!-- Shipping & Returns -->
          <div class="accordion-item border border-gray-200">
            <button class="accordion-header w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 transition-colors">
              <span class="text-xs tracking-widest text-gray-900">SHIPPING & RETURNS</span>
              <span class="accordion-icon text-gray-400">+</span>
            </button>
            <div class="accordion-content">
              <div id="product-shipping-content" class="px-4 pb-4 text-xs text-gray-600 leading-relaxed space-y-2">
                <p>Shipping information will load here...</p>
              </div>
            </div>
          </div>

          <!-- Care Instructions -->
          <div class="accordion-item border border-gray-200">
            <button class="accordion-header w-full flex justify-between items-center p-4 text-left hover:bg-gray-50 transition-colors">
              <span class="text-xs tracking-widest text-gray-900">CARE INSTRUCTIONS</span>
              <span class="accordion-icon text-gray-400">+</span>
            </button>
            <div class="accordion-content">
              <div id="product-care-content" class="px-4 pb-4 text-xs text-gray-600 leading-relaxed space-y-2">
                <p>Care instructions will load here...</p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="border-t border-gray-200 px-4 md:px-8 py-12">
    <div class="max-w-6xl mx-auto grid grid-cols-2 md:grid-cols-4 gap-8 text-xs">
      <div>
        <p class="tracking-widest text-gray-900 mb-3">SHOP</p>
        <a href="/new-in.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">New In</a>
        <a href="/selvedge-jeans.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Selvedge Jeans</a>
        <a href="/denim-jackets.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Denim Jackets</a>
        <a href="/americana.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Americana Wear</a>
        <a href="/accessories.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Accessories</a>
        <a href="/sale.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Sale</a>
      </div>
      <div>
        <p class="tracking-widest text-gray-900 mb-3">INFO</p>
        <a href="our-story.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Our Story</a>
        <a href="denim-guide.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Denim Guide</a>
        <a href="journal.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">The Journal</a>
        <a href="sustainability.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Sustainability</a>
        <a href="careers.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Careers</a>
      </div>
      <div>
        <p class="tracking-widest text-gray-900 mb-3">HELP</p>
        <a href="faq.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">FAQ</a>
        <a href="size-guide.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Size Guide</a>
        <a href="shipping-returns.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Shipping & Returns</a>
        <a href="repairs-hemming.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Repairs & Hemming</a>
        <a href="contact.html" class="block text-gray-500 mb-1.5 hover:text-black transition-colors">Contact Us</a>
      </div>
      <div>
        <p class="tracking-widest text-gray-900 mb-3">FOLLOW US</p>
        <p class="text-gray-500 mb-1.5 cursor-pointer hover:text-black transition-colors">Instagram</p>
        <p class="text-gray-500 mb-1.5 cursor-pointer hover:text-black transition-colors">TikTok</p>
        <p class="text-gray-500 mb-1.5 cursor-pointer hover:text-black transition-colors">Pinterest</p>
        <p class="text-gray-500 mb-1.5 cursor-pointer hover:text-black transition-colors">YouTube</p>
      </div>
    </div>
    <div class="max-w-6xl mx-auto mt-10 pt-6 border-t border-gray-100 flex flex-col md:flex-row justify-between items-center text-xs text-gray-400">
      <p>© 2026 Quickdraw Pressing Co. All rights reserved.</p>
      <div class="flex gap-4 mt-2 md:mt-0">
        <span class="cursor-pointer hover:text-black transition-colors">Privacy Policy</span>
        <span class="cursor-pointer hover:text-black transition-colors">Terms & Conditions</span>
        <span class="cursor-pointer hover:text-black transition-colors">Cookie Policy</span>
      </div>
    </div>
  </footer>

  <script src="/cart.js"></script>
  <script>
    const API_BASE_URL = 'http://localhost:8000/api';
    let currentProduct = null;
    let selectedSize = null;

    // Extract slug from URL
    function getProductSlug() {
      // Support both query parameter and path-based URLs
      const urlParams = new URLSearchParams(window.location.search);
      const querySlug = urlParams.get('slug');

      if (querySlug) return querySlug;

      // Extract from path: /products/frontier-slim -> frontier-slim
      const pathParts = window.location.pathname.split('/');
      return pathParts[pathParts.length - 1].replace('.html', '');
    }

    // HTML escape utility
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Load product data from API
    async function loadProduct() {
      const slug = getProductSlug();

      if (!slug || slug === 'product') {
        showError();
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/products/${slug}`);

        if (!response.ok) {
          throw new Error('Product not found');
        }

        const data = await response.json();
        currentProduct = data.data;

        populateProduct(currentProduct);
        hideLoading();

      } catch (error) {
        console.error('Error loading product:', error);
        showError();
      }
    }

    // Populate product data
    function populateProduct(product) {
      // Update meta tags
      document.getElementById('page-title').textContent = `${product.name} | Quickdraw Pressing Co.`;
      document.getElementById('page-description').content = product.desc || product.full_description || '';
      document.getElementById('og-title').content = product.name;
      document.getElementById('og-description').content = product.desc || '';

      // Product info
      document.getElementById('product-name').textContent = product.name;
      document.getElementById('product-price').textContent = product.price; // API already includes €
      document.getElementById('product-description').textContent = product.desc || product.full_description || '';

      // Category - API returns array of category name strings
      if (product.categories && product.categories.length > 0) {
        const categoryName = product.categories[0];
        document.getElementById('product-category').textContent = categoryName.toUpperCase();
        document.getElementById('breadcrumb-category').textContent = categoryName;
      }
      document.getElementById('breadcrumb-product').textContent = product.name;

      // Tag badge
      if (product.tag) {
        const tagEl = document.getElementById('product-tag');
        tagEl.textContent = product.tag;
        tagEl.classList.remove('hidden');
        if (product.tag === 'SALE') {
          tagEl.style.backgroundColor = '#c45a3a';
        }
      }

      // Images
      populateImages(product);

      // Fabric specs
      populateSpecs(product);

      // Sizes
      populateSizes(product);

      // Accordion content
      populateAccordions(product);
    }

    // Populate images
    function populateImages(product) {
      const mainImage = document.getElementById('main-product-image');
      const thumbnailGrid = document.getElementById('thumbnail-grid');

      if (product.images && product.images.length > 0) {
        const images = product.images;
        // Find main image, or use first gallery/thumbnail image
        const mainImg = images.find(img => img.type === 'main') ||
                        images.find(img => img.type === 'gallery') ||
                        images[0];

        mainImage.src = mainImg.url;
        mainImage.alt = mainImg.alt || product.name;
        document.getElementById('og-image').content = mainImg.url;

        // Populate thumbnails
        thumbnailGrid.innerHTML = '';
        images.slice(0, 5).forEach((img, index) => {
          const thumb = document.createElement('div');
          thumb.className = `thumbnail aspect-square bg-gray-100 cursor-pointer overflow-hidden transition-colors ${
            index === 0 ? 'border-2 border-black' : 'border border-gray-200 hover:border-gray-400'
          }`;
          thumb.setAttribute('data-image', img.url);
          thumb.innerHTML = `<img src="${img.url}" alt="${img.alt || product.name}" class="w-full h-full object-cover">`;
          thumbnailGrid.appendChild(thumb);
        });

        // Add thumbnail click handlers
        setupImageGallery();
      }
    }

    // Populate specs
    function populateSpecs(product) {
      const specsGrid = document.getElementById('specs-grid');
      specsGrid.innerHTML = '';

      const specs = [
        { label: 'Weight', value: product.weight },
        { label: 'Mill', value: product.mill },
        { label: 'Composition', value: product.composition },
        { label: 'Construction', value: product.construction },
        { label: 'Treatment', value: product.treatment },
        { label: 'Sanforization', value: product.sanforization }
      ];

      specs.forEach(spec => {
        if (spec.value) {
          const specEl = document.createElement('div');
          specEl.innerHTML = `
            <span class="text-gray-500">${escapeHtml(spec.label)}</span>
            <p class="text-gray-900 font-medium">${escapeHtml(spec.value)}</p>
          `;
          specsGrid.appendChild(specEl);
        }
      });

      // Hide specs section if no specs
      if (specsGrid.children.length === 0) {
        document.getElementById('fabric-specs').style.display = 'none';
      }
    }

    // Populate sizes
    function populateSizes(product) {
      const sizeSelector = document.getElementById('size-selector');
      sizeSelector.innerHTML = '';

      const sizes = product.sizes || product.sizes_available || [];
      if (sizes.length > 0) {
        sizes.forEach(size => {
          const btn = document.createElement('button');
          btn.className = 'size-option border border-gray-300 py-3 text-sm hover:border-black transition-colors';
          btn.textContent = size;
          btn.setAttribute('data-size', size);
          sizeSelector.appendChild(btn);
        });

        setupSizeSelection();
      } else {
        sizeSelector.innerHTML = '<p class="text-sm text-gray-500">One Size</p>';
        selectedSize = 'One Size';
      }
    }

    // Populate accordions
    function populateAccordions(product) {
      // Product Details
      if (product.full_description) {
        document.getElementById('product-details-content').innerHTML =
          product.full_description.split('\n').map(line => `<p>${escapeHtml(line)}</p>`).join('');
      }

      // Sizing
      if (product.sizing_info) {
        document.getElementById('product-sizing-content').innerHTML =
          product.sizing_info.split('\n').map(line => `<p>${escapeHtml(line)}</p>`).join('');
      }

      // Shipping
      if (product.shipping_info) {
        document.getElementById('product-shipping-content').innerHTML =
          product.shipping_info.split('\n').map(line => `<p>${escapeHtml(line)}</p>`).join('');
      }

      // Care
      if (product.care_instructions) {
        document.getElementById('product-care-content').innerHTML =
          product.care_instructions.split('\n').map(line => `<p>${escapeHtml(line)}</p>`).join('');
      }
    }

    // Setup image gallery
    function setupImageGallery() {
      const thumbnails = document.querySelectorAll('.thumbnail');
      const mainImage = document.getElementById('main-product-image');

      thumbnails.forEach(thumb => {
        thumb.addEventListener('click', () => {
          const newImageSrc = thumb.getAttribute('data-image');
          mainImage.src = newImageSrc;

          thumbnails.forEach(t => {
            t.classList.remove('border-2', 'border-black');
            t.classList.add('border', 'border-gray-200');
          });
          thumb.classList.remove('border', 'border-gray-200');
          thumb.classList.add('border-2', 'border-black');
        });
      });
    }

    // Setup size selection
    function setupSizeSelection() {
      const sizeButtons = document.querySelectorAll('.size-option');
      sizeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          sizeButtons.forEach(b => {
            b.classList.remove('bg-black', 'text-white', 'border-black');
            b.classList.add('border-gray-300');
          });
          btn.classList.add('bg-black', 'text-white', 'border-black');
          btn.classList.remove('border-gray-300');
          selectedSize = btn.getAttribute('data-size');
        });
      });
    }

    // Setup accordion
    function setupAccordions() {
      const accordionHeaders = document.querySelectorAll('.accordion-header');
      accordionHeaders.forEach(header => {
        header.addEventListener('click', () => {
          const content = header.nextElementSibling;
          const icon = header.querySelector('.accordion-icon');
          const isActive = content.classList.contains('active');

          document.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('active'));
          document.querySelectorAll('.accordion-icon').forEach(i => i.textContent = '+');

          if (!isActive) {
            content.classList.add('active');
            icon.textContent = '−';
          }
        });
      });
    }

    // Add to cart handler
    document.getElementById('add-to-cart-btn').addEventListener('click', function() {
      if (!currentProduct) {
        alert('Product not loaded yet');
        return;
      }

      const sizes = currentProduct.sizes || currentProduct.sizes_available || [];
      if (!selectedSize && sizes.length > 0) {
        alert('Please select a size');
        return;
      }

      const mainImage = currentProduct.images && currentProduct.images.length > 0
        ? currentProduct.images.find(img => img.type === 'main') || currentProduct.images[0]
        : null;

      // Enhanced cart data with productId and slug
      QuickdrawCart.add({
        productId: currentProduct.id,
        slug: currentProduct.slug,
        name: currentProduct.name,
        desc: currentProduct.desc || currentProduct.full_description?.substring(0, 100) || '',
        price: currentProduct.price, // API already includes € symbol
        priceNum: currentProduct.priceNum || parseFloat(currentProduct.price.replace(/[^0-9.]/g, '')),
        image: mainImage ? mainImage.url : '',
        size: selectedSize || 'One Size',
        qty: 1
      });
    });

    // Add to wishlist handler (placeholder)
    document.getElementById('add-to-wishlist-btn').addEventListener('click', async function() {
      const authToken = localStorage.getItem('auth_token');

      if (!authToken) {
        alert('Please login to add items to your wishlist');
        window.location.href = '/login.html';
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/wishlist/add`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({ product_id: currentProduct.id })
        });

        if (response.ok) {
          alert('Added to wishlist!');
          this.innerHTML = '♥ ADDED TO WISHLIST';
        } else {
          alert('Failed to add to wishlist');
        }
      } catch (error) {
        console.error('Error adding to wishlist:', error);
        alert('Failed to add to wishlist');
      }
    });

    // Show/hide loading and error states
    function hideLoading() {
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('product-content').classList.remove('hidden');
    }

    function showError() {
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('error-state').classList.remove('hidden');
    }

    // Initialize
    setupAccordions();
    loadProduct();
  </script>

</body>
</html>
